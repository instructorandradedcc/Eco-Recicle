<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ECORECYCLE: Explorador Interactivo</title>
    <link rel="icon" href="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: #e2e8f0; 
            overflow: hidden; 
            margin: 0; padding: 0;
            height: 100vh; width: 100vw;
        }
        .font-rajdhani { font-family: 'Rajdhani', sans-serif; }

        /* --- FONDO ANIMADO --- */
        .bg-neural {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #020617 100%);
            z-index: -2;
            transition: background 1s ease;
        }
        .bg-grid {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(56, 189, 248, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(56, 189, 248, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            mask-image: radial-gradient(circle at center, black 40%, transparent 80%);
        }

        /* --- LAYOUT --- */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100%; position: relative; }
        
        .app-header { 
            flex: 0 0 70px; z-index: 50; 
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .title-section { 
            flex: 0 0 auto; text-align: center; padding-top: 1.5rem; padding-bottom: 0.5rem; z-index: 10; 
            transition: all 0.5s ease;
        }
        
        .cinematic-h2 {
            font-family: 'Rajdhani', sans-serif; font-size: 2.5rem; font-weight: 700;
            letter-spacing: 4px; color: white; text-shadow: 0 0 20px rgba(74, 222, 128, 0.3); line-height: 1;
        }
        .cinematic-p { font-size: 0.85rem; letter-spacing: 3px; color: #94a3b8; text-transform: uppercase; margin-top: 0.5rem; }

        /* --- ESCENARIO 3D --- */
        .graph-stage { 
            flex: 1; position: relative; display: flex; align-items: center; justify-content: center; 
            perspective: 1000px; overflow: hidden; 
        }
        
        .eco-hub-container { 
            position: relative; width: 100%; height: 100%; 
            display: flex; align-items: center; justify-content: center; 
            transform-style: preserve-3d; 
        }

        /* --- L√çNEAS --- */
        .neural-line {
            position: absolute; top: 50%; left: 50%; height: 2px;
            transform-origin: 0% 50%; z-index: 1; width: 0;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none; box-shadow: 0 0 8px currentColor;
            opacity: 0.6;
        }

        /* --- NODOS --- */
        .eco-node {
            position: absolute; border-radius: 50%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; cursor: pointer;
            backdrop-filter: blur(12px); 
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            z-index: 10; 
            transform: translate(-50%, -50%) scale(0); /* Estado inicial invisible */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: rgba(15, 23, 42, 0.9);
            border-style: solid;
        }

        .eco-node:hover { 
            z-index: 50; 
            transform: translate(-50%, -50%) scale(1.15) !important; 
            box-shadow: 0 0 40px currentColor; 
        }

        /* Tama√±os de Nodos */
        .node-center { width: 160px; height: 160px; border-width: 4px; z-index: 20; font-size: 1rem; }
        .node-branch { width: 120px; height: 120px; border-width: 2px; z-index: 15; font-size: 0.85rem; } /* Ramas Principales */
        .node-leaf { width: 90px; height: 90px; border-width: 1px; z-index: 10; font-size: 0.7rem; } /* Productos/Detalles */

        /* Animaci√≥n de "Salida" (Zoom In effect) */
        .zooming-out {
            opacity: 0;
            transform: translate(-50%, -50%) scale(5) !important;
            filter: blur(10px);
        }
        
        /* Animaci√≥n de "Entrada" (Zoom In effect) */
        .zooming-in {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0) !important;
        }

        /* --- BOT√ìN VOLVER (BREADCRUMBS) --- */
        .nav-controls {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 60;
            opacity: 0; pointer-events: none; transition: opacity 0.5s;
        }
        .nav-controls.visible { opacity: 1; pointer-events: auto; }

        .nav-btn {
            background: rgba(15, 23, 42, 0.9); border: 1px solid #334155; color: #94a3b8;
            padding: 10px 20px; border-radius: 30px; font-family: 'Rajdhani', sans-serif;
            font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;
            transition: all 0.3s;
        }
        .nav-btn:hover { background: #334155; color: white; border-color: white; }
        .nav-btn-home { border-color: #22c55e; color: #22c55e; }
        .nav-btn-home:hover { background: #22c55e; color: #020617; }

        /* --- PANEL LATERAL --- */
        .side-panel {
            width: 450px; background: rgba(15, 23, 42, 0.98); border-left: 1px solid #334155;
            position: absolute; right: 0; top: 70px; bottom: 0; transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1); z-index: 100;
            box-shadow: -20px 0 60px rgba(0,0,0,0.9); display: flex; flex-direction: column;
        }
        .side-panel.open { transform: translateX(0); }
        .panel-content { padding: 2.5rem; overflow-y: auto; flex: 1; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        @media (max-width: 768px) {
            .cinematic-h2 { font-size: 1.8rem; }
            .node-center { width: 130px; height: 130px; font-size: 0.8rem; }
            .node-branch { width: 100px; height: 100px; font-size: 0.7rem; }
            .node-leaf { width: 80px; height: 80px; font-size: 0.65rem; }
            .side-panel { width: 100%; top: 60px; }
            .nav-controls { width: 90%; justify-content: center; flex-wrap: wrap; }
        }
    </style>
</head>
<body>

    <div class="bg-neural" id="bg-neural"></div>
    <div class="bg-grid"></div>

    <div class="app-container">
        
        <header class="app-header flex items-center justify-between px-6 shadow-lg">
            <div class="flex items-center gap-3 cursor-pointer" onclick="navigateTo('macro')">
                <img src="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" class="h-10 w-10 rounded-full border border-green-500 shadow-[0_0_10px_#22c55e]" alt="Logo">
                <div>
                    <h1 class="font-rajdhani font-bold text-xl text-white leading-none">ECORECYCLE</h1>
                    <span class="text-[10px] text-green-400 uppercase tracking-widest">Evolution</span>
                </div>
            </div>
            <nav class="hidden md:flex gap-6">
                <div class="flex items-center gap-2 text-xs text-slate-400">
                    <i class="fa-solid fa-circle-info"></i>
                    <span>SISTEMA DE NAVEGACI√ìN INTELIGENTE</span>
                </div>
            </nav>
        </header>

        <div class="title-section">
            <h2 class="cinematic-h2" id="main-title">MACRO-ECOSISTEMA</h2>
            <div class="h-1 w-24 bg-green-500 mx-auto rounded-full mt-2 shadow-[0_0_15px_#22c55e]" id="title-bar"></div>
            <p class="cinematic-p" id="sub-title">CENTRO DE OPERACIONES ECA</p>
        </div>

        <div class="graph-stage">
            <div id="hub-container" class="eco-hub-container"></div>
            
            <!-- CONTROLES DE NAVEGACI√ìN -->
            <div class="nav-controls" id="nav-controls">
                <button class="nav-btn nav-btn-home" onclick="navigateTo('macro')">
                    <i class="fa-solid fa-network-wired"></i> ECA CENTRAL
                </button>
                <button class="nav-btn" id="btn-back" onclick="goBack()">
                    <i class="fa-solid fa-arrow-rotate-left"></i> Atr√°s
                </button>
            </div>
        </div>

    </div>

    <!-- PANEL LATERAL -->
    <aside class="side-panel" id="side-panel">
        <div class="flex justify-between items-center p-4 border-b border-slate-800 bg-slate-900/50">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Detalle del Nodo</span>
            <button onclick="closePanel()" class="text-slate-400 hover:text-white transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-800">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        <div id="panel-content" class="panel-content"></div>
    </aside>

    <script>
        // ==========================================
        // BASE DE DATOS JER√ÅRQUICA (√ÅRBOL DE NODOS)
        // ==========================================
        const DB = {
            // NODO RAIZ
            'macro': {
                title: "MACRO-ECOSISTEMA", subtitle: "ECA: Estaci√≥n Central de Aprovechamiento",
                color: "#22c55e", icon: "fa-solid fa-network-wired",
                nodes: [
                    { id: 'rcd', label: 'Gesti√≥n RCD', icon: 'fa-solid fa-trowel-bricks', color: '#3b82f6', angle: -90 },
                    { id: 'ecocidas', label: 'Tecnolog√≠a (IA)', icon: 'fa-solid fa-microchip', color: '#a855f7', angle: -30 },
                    { id: 'ecocia', label: 'ECO-CIA Rural', icon: 'fa-solid fa-wheat-awn', color: '#6366f1', angle: 30 },
                    { id: 'lodos', label: 'Lodos PTAR', icon: 'fa-solid fa-droplet', color: '#94a3b8', angle: 90 },
                    { id: 'organicos', label: 'Org√°nicos', icon: 'fa-solid fa-leaf', color: '#eab308', angle: 150 },
                    { id: 'reciclables', label: 'Reciclables', icon: 'fa-solid fa-recycle', color: '#14b8a6', angle: 210 }
                ]
            },

            // --- RAMA 1: RCD ---
            'rcd': {
                parent: 'macro', title: "L√çNEA RCD", subtitle: "Transformaci√≥n de Escombros",
                color: "#3b82f6", icon: "fa-solid fa-industry",
                nodes: [
                    { id: 'rcd_prod', label: 'Productos', icon: 'fa-solid fa-cubes', type: 'branch', angle: -90 },
                    { id: 'rcd_char', label: 'Caracter√≠sticas', icon: 'fa-solid fa-cogs', type: 'branch', angle: 30 },
                    { id: 'rcd_legal', label: 'Legalidad', icon: 'fa-solid fa-scale-balanced', type: 'legal', angle: 150 }
                ]
            },
                // RCD -> Productos
                'rcd_prod': {
                    parent: 'rcd', title: "CAT√ÅLOGO RCD", subtitle: "Materiales Sostenibles",
                    color: "#60a5fa", icon: "fa-solid fa-cubes",
                    nodes: [
                        { id: 'p_ladrillo', label: 'Ladrillos', icon: 'üß±', angle: -90 }, // Ladrillo Lego/Estructural
                        { id: 'p_adoquin', label: 'Adoquines', icon: 'üî≤', angle: -45 },
                        { id: 'p_via', label: 'Base B-200', icon: 'üõ£Ô∏è', angle: 0 },
                        { id: 'p_mob', label: 'Mobiliario', icon: 'ü™ë', angle: 45 },
                        { id: 'p_tub', label: 'Tuber√≠as', icon: 'üöá', angle: 90 }
                    ]
                },
                // RCD -> Caracter√≠sticas
                'rcd_char': {
                    parent: 'rcd', title: "PROCESO RCD", subtitle: "Operaci√≥n y Tecnolog√≠a",
                    color: "#93c5fd", icon: "fa-solid fa-cogs",
                    nodes: [
                        { id: 'c_maq', label: 'Maquinaria', icon: 'üöú', angle: -60 }, // Bobcat, Retro
                        { id: 'c_soc', label: 'Carretilleros', icon: 'üê¥', angle: 60 }, // Sustituci√≥n VTA
                        { id: 'c_cap', label: '30k Ton/A√±o', icon: 'üìà', angle: 180 }
                    ]
                },

            // --- RAMA 2: ORG√ÅNICOS ---
            'organicos': {
                parent: 'macro', title: "L√çNEA ORG√ÅNICA", subtitle: "Bioreactores y Alimentos",
                color: "#eab308", icon: "fa-solid fa-leaf",
                nodes: [
                    { id: 'org_prod', label: 'Productos', icon: 'fa-solid fa-box-open', type: 'branch', angle: -90 },
                    { id: 'org_char', label: 'Caracter√≠sticas', icon: 'fa-solid fa-microscope', type: 'branch', angle: 30 },
                    { id: 'org_legal', label: 'Legalidad', icon: 'fa-solid fa-scale-balanced', type: 'legal', angle: 150 }
                ]
            },
                // Org√°nicos -> Productos
                'org_prod': {
                    parent: 'organicos', title: "PRODUCTOS BIO", subtitle: "Abonos y Alimentos",
                    color: "#facc15", icon: "fa-solid fa-box-open",
                    nodes: [
                        { id: 'p_abono', label: 'Bio-Abono', icon: 'üå±', angle: -90 },
                        { id: 'p_biogas', label: 'Biog√°s', icon: '‚ö°', angle: 0 },
                        { id: 'p_huevos', label: 'Huevos', icon: 'ü•ö', angle: 90 }, // De Eco-Aldeas
                        { id: 'p_peces', label: 'Peces', icon: 'üêü', angle: 180 }
                    ]
                },
                // Org√°nicos -> Caracter√≠sticas
                'org_char': {
                    parent: 'organicos', title: "MODELO BIO", subtitle: "Tecnolog√≠a SITAV",
                    color: "#fde047", icon: "fa-solid fa-microscope",
                    nodes: [
                        { id: 'c_sitav', label: 'Bioreactores', icon: '‚öóÔ∏è', angle: -45 },
                        { id: 'c_aldea', label: 'Eco-Aldea', icon: 'üè°', angle: 45 }, // 50-100 gallinas
                        { id: 'c_circ', label: 'Circular', icon: '‚ôªÔ∏è', angle: 180 }
                    ]
                },

            // --- RAMA 3: RECICLABLES ---
            'reciclables': {
                parent: 'macro', title: "L√çNEA RECICLAJE", subtitle: "Valorizaci√≥n Materiales",
                color: "#14b8a6", icon: "fa-solid fa-recycle",
                nodes: [
                    { id: 'rec_prod', label: 'Productos', icon: 'fa-solid fa-shapes', type: 'branch', angle: -90 },
                    { id: 'rec_char', label: 'Caracter√≠sticas', icon: 'fa-solid fa-sliders', type: 'branch', angle: 30 },
                    { id: 'rec_legal', label: 'Legalidad', icon: 'fa-solid fa-scale-balanced', type: 'legal', angle: 150 }
                ]
            },
                'rec_prod': {
                    parent: 'reciclables', title: "TRANSFORMACI√ìN", subtitle: "Nuevos Materiales",
                    color: "#2dd4bf", icon: "fa-solid fa-shapes",
                    nodes: [
                        { id: 'p_madera', label: 'Madera P.', icon: 'ü™µ', angle: -90 },
                        { id: 'p_fil', label: 'Filamento 3D', icon: 'üßµ', angle: 0 },
                        { id: 'p_comb', label: 'Combustibles', icon: 'üî•', angle: 90 }, // Pir√≥lisis
                        { id: 'p_jab', label: 'Jabones', icon: 'üßº', angle: 180 } // Aceites
                    ]
                },
                'rec_char': {
                    parent: 'reciclables', title: "SISTEMA ECA", subtitle: "Log√≠stica y Tech",
                    color: "#5eead4", icon: "fa-solid fa-sliders",
                    nodes: [
                        { id: 'c_tie', label: 'Eco-Tiendas', icon: 'üè™', angle: -45 }, // Canje
                        { id: 'c_pir', label: 'Pir√≥lisis', icon: 'üè≠', angle: 45 },
                        { id: 'c_inc', label: 'Inclusi√≥n', icon: 'ü§ù', angle: 180 }
                    ]
                },

            // --- RAMA 4: TECNOLOG√çA (ECO-CIDAS) ---
            'ecocidas': {
                parent: 'macro', title: "ECO-CIDAS", subtitle: "Tecnolog√≠a e IA",
                color: "#a855f7", icon: "fa-solid fa-microchip",
                nodes: [
                    { id: 'tec_prod', label: 'Innovaci√≥n', icon: 'fa-solid fa-robot', type: 'branch', angle: -90 },
                    { id: 'tec_char', label: 'Caracter√≠sticas', icon: 'fa-solid fa-server', type: 'branch', angle: 30 },
                    { id: 'tec_legal', label: 'Legalidad', icon: 'fa-solid fa-scale-balanced', type: 'legal', angle: 150 }
                ]
            },
                'tec_prod': {
                    parent: 'ecocidas', title: "I+D+i", subtitle: "Productos Tecnol√≥gicos",
                    color: "#c084fc", icon: "fa-solid fa-robot",
                    nodes: [
                        { id: 'p_prot', label: 'Pr√≥tesis', icon: 'ü¶æ', angle: -90 },
                        { id: 'p_soft', label: 'ERP + IA', icon: 'üíª', angle: 0 },
                        { id: 'p_iot', label: 'Sensores', icon: 'üì°', angle: 90 }
                    ]
                },
                'tec_char': {
                    parent: 'ecocidas', title: "CITTA", subtitle: "Centro Investigaci√≥n",
                    color: "#d8b4fe", icon: "fa-solid fa-server",
                    nodes: [
                        { id: 'c_vis', label: 'Visi√≥n Art.', icon: 'üëÅÔ∏è', angle: -45 },
                        { id: 'c_auto', label: 'Automatizaci√≥n', icon: 'ü§ñ', angle: 45 },
                        { id: 'c_edu', label: 'Chatbots', icon: 'üéì', angle: 180 }
                    ]
                },
            
            // --- OTRAS RAMAS SIMPLIFICADAS ---
            'ecocia': {
                parent: 'macro', title: "ECO-CIA", subtitle: "Log√≠stica Rural",
                color: "#6366f1", icon: "fa-solid fa-wheat-awn",
                nodes: [
                     { id: 'cia_car', label: 'Log√≠stica', icon: 'üöö', type: 'branch', angle: 0 },
                     { id: 'cia_leg', label: 'Legalidad', icon: '‚öñÔ∏è', type: 'legal', angle: 180 }
                ]
            },
            'lodos': {
                parent: 'macro', title: "LODOS", subtitle: "Saneamiento",
                color: "#94a3b8", icon: "fa-solid fa-droplet",
                nodes: [
                     { id: 'lod_car', label: 'Proceso', icon: '‚öôÔ∏è', type: 'branch', angle: 0 },
                     { id: 'lod_leg', label: 'Legalidad', icon: '‚öñÔ∏è', type: 'legal', angle: 180 }
                ]
            }
        };

        // ==========================================
        // CONTENIDO DETALLADO (TEXTOS)
        // ==========================================
        const TEXTS = {
            // RCD
            'rcd_legal': { title: "Marco Legal RCD", text: "<strong>Resoluci√≥n 1257 de 2021:</strong> Regula al Gestor de RCD y Plantas de Aprovechamiento.<br><strong>NTC 6421:</strong> Calidad de agregados reciclados.<br><strong>NTC 2017:</strong> Resistencia de adoquines.<br><strong>NTC 4026/4076:</strong> Normas para bloques estructurales y divisorios." },
            'p_ladrillo': { title: "Ladrillos Ecol√≥gicos", text: "Fabricados con √°ridos reciclados. Tipos: Lego (autoconstrucci√≥n), Estructural y Macizo. Ahorran costos y CO2." },
            'p_adoquin': { title: "Adoquines", text: "Para espacio p√∫blico. Cumplen NTC 2017 (>4.2 MPa). Incluye 'Gramoquines' permeables." },
            'c_maq': { title: "Maquinaria", text: "Uso de Bobcats, Retroexcavadoras y Trituradoras industriales. Kit de automatizaci√≥n con IA opcional." },
            'c_soc': { title: "Sustituci√≥n VTA", text: "Formalizaci√≥n de 300 carretilleros. Cambio de tracci√≥n animal a unidades productivas motorizadas (Ley 2138)." },
            
            // ORG√ÅNICOS
            'org_legal': { title: "Normativa Bio", text: "<strong>Res ICA 0684:</strong> Registro de Productor de Abonos Org√°nicos.<br><strong>NTC 5167:</strong> L√≠mites de pat√≥genos y metales.<br><strong>Res ICA 3651/2640:</strong> Bioseguridad en granjas av√≠colas y porc√≠colas (Prohibici√≥n de lavazas)." },
            'p_abono': { title: "Abono Formulado", text: "Fertilizante org√°nico libre de pat√≥genos. Producci√≥n proyectada: 1.2M unidades/a√±o." },
            'c_sitav': { title: "Tecnolog√≠a SITAV", text: "Sistema de bioreactores acelerados. Controla pH y temperatura para compostaje r√°pido." },
            'c_aldea': { title: "Eco-Aldeas", text: "Unidades productivas de 50-100 gallinas, cerdos y huertas. Econom√≠a circular: residuos alimentan animales, esti√©rcol genera biog√°s." },

            // RECICLABLES
            'rec_legal': { title: "Normativa Reciclaje", text: "<strong>Decreto 596 de 2016:</strong> Operatividad de ECAs y tarifa de aseo.<br><strong>Res 1407:</strong> Responsabilidad Extendida del Productor (REP) Envases.<br><strong>Dec 1076:</strong> Licencia ambiental para pir√≥lisis." },
            'p_comb': { title: "Combustibles", text: "Obtenidos por pir√≥lisis de pl√°sticos y llantas. Aceites usados convertidos en Biodi√©sel o Jabones." },
            'c_tie': { title: "Eco-Tiendas", text: "Puntos barriales de canje. La comunidad intercambia residuos separados por alimentos o productos de las Eco-Aldeas." },

            // TECNOLOG√çA
            'tec_legal': { title: "Normativa Tech", text: "<strong>Dec 4725:</strong> Dispositivos m√©dicos sobre medida (Pr√≥tesis).<br><strong>Ley 1581:</strong> Habeas Data y √©tica de IA.<br><strong>RAC 100:</strong> Regulaci√≥n de drones agr√≠colas." },
            'p_prot': { title: "Pr√≥tesis Bi√≥nicas", text: "Fabricadas con pl√°stico reciclado (PET/PP) y dise√±o generativo por IA. Bajo costo y alta personalizaci√≥n." },
            'c_vis': { title: "Visi√≥n Artificial", text: "C√°maras que identifican materiales en bandas transportadoras para clasificaci√≥n autom√°tica." }
        };

        // ==========================================
        // L√ìGICA DE NAVEGACI√ìN "ZOOM"
        // ==========================================
        let currentId = 'macro';
        let historyStack = [];

        function renderNode(id, fromBack = false) {
            const container = document.getElementById('hub-container');
            const data = DB[id];
            
            if (!data) return;

            // 1. Preparar animaci√≥n de salida
            const oldNodes = document.querySelectorAll('.eco-node, .neural-line');
            oldNodes.forEach(el => {
                if(fromBack) el.classList.add('zooming-in'); // Si volvemos, se encogen
                else el.classList.add('zooming-out'); // Si avanzamos, se expanden hacia la c√°mara
                el.style.opacity = '0';
            });

            // 2. Esperar y renderizar nuevo nivel
            setTimeout(() => {
                container.innerHTML = '';
                
                // Actualizar T√≠tulos
                document.getElementById('main-title').innerText = data.title;
                document.getElementById('sub-title').innerText = data.subtitle;
                document.getElementById('title-bar').style.backgroundColor = data.color;
                document.getElementById('title-bar').style.boxShadow = `0 0 15px ${data.color}`;

                // NODO CENTRAL (El que acabamos de "hacer zoom")
                const centerNode = createNode('center', {
                    id: id, label: data.parent ? 'VOLVER' : 'ECA CENTRAL', 
                    icon: data.icon, color: data.color
                }, true);
                
                // Click en el centro -> Si tiene padre, vuelve atr√°s. Si es Macro, nada.
                centerNode.onclick = () => { if(data.parent) goBack(); };
                container.appendChild(centerNode);

                // NODOS HIJOS (Ramas)
                if (data.nodes) {
                    const radius = window.innerWidth < 768 ? 38 : 30; // % del ancho
                    
                    data.nodes.forEach((node, i) => {
                        // Calcular Posici√≥n
                        const rad = (node.angle * Math.PI) / 180;
                        const x = 50 + (radius * Math.cos(rad));
                        const y = 50 + (radius * Math.sin(rad));

                        // L√≠nea
                        const line = document.createElement('div');
                        line.className = 'neural-line';
                        line.style.background = `linear-gradient(90deg, transparent 0%, ${node.color || data.color} 100%)`;
                        line.style.color = node.color || data.color;
                        line.style.transform = `rotate(${node.angle}deg)`;
                        container.appendChild(line);

                        // Nodo
                        let typeClass = 'node-branch'; // Defecto
                        if (node.type === 'legal') typeClass = 'node-leaf border-dashed';
                        else if (!node.type && id !== 'macro') typeClass = 'node-leaf';

                        const childNode = document.createElement('div');
                        childNode.className = `eco-node ${typeClass}`;
                        childNode.style.borderColor = node.color || data.color;
                        childNode.style.left = `${x}%`;
                        childNode.style.top = `${y}%`;
                        
                        // Icono especial para legal
                        const iconHtml = node.type === 'legal' 
                            ? `<i class="${node.icon} text-2xl mb-1 text-yellow-400"></i>` 
                            : `<i class="${node.icon} text-2xl mb-1" style="color:${node.color || data.color}"></i>`;

                        childNode.innerHTML = `
                            ${iconHtml}
                            <span class="leading-none text-slate-200 px-1">${node.label}</span>
                        `;

                        // EVENTO CLICK
                        childNode.onclick = () => {
                            if (node.type === 'legal') {
                                // Caso Especial: Legalidad -> Abre Panel
                                showInfo(id + '_legal', "Marco Legal", node.color || data.color);
                            } else if (DB[node.id]) {
                                // Caso Normal: Navegar (Zoom In)
                                navigateTo(node.id);
                            } else {
                                // Caso Hoja (Producto/Caracter√≠stica) -> Abre Info
                                showInfo(node.id, node.label, node.color || data.color);
                            }
                        };

                        container.appendChild(childNode);

                        // Animaci√≥n de entrada de los nuevos nodos
                        setTimeout(() => {
                            line.style.width = `${radius}%`;
                            childNode.style.transform = 'translate(-50%, -50%) scale(1)';
                        }, 100 + (i * 50));
                    });
                }
                
                // Entrada del centro
                setTimeout(() => { centerNode.style.transform = 'translate(-50%, -50%) scale(1)'; }, 50);

                // Actualizar UI Controles
                updateNavUI(id);

            }, 500);
        }

        function createNode(type, data, isCenter) {
            const div = document.createElement('div');
            div.className = `eco-node ${isCenter ? 'node-center' : 'node-branch'}`;
            div.style.borderColor = data.color;
            div.style.left = '50%';
            div.style.top = '50%';
            div.style.zIndex = isCenter ? 20 : 10;
            
            div.innerHTML = `
                <i class="${data.icon} text-4xl mb-2" style="color:${data.color}"></i>
                <span class="font-bold tracking-widest text-xs uppercase text-slate-300">${data.label}</span>
            `;
            return div;
        }

        function navigateTo(id) {
            if (id === currentId) return;
            historyStack.push(currentId);
            currentId = id;
            renderNode(id, false);
        }

        function goBack() {
            if (historyStack.length === 0) return;
            const prevId = historyStack.pop();
            currentId = prevId;
            renderNode(prevId, true);
        }

        function updateNavUI(id) {
            const controls = document.getElementById('nav-controls');
            const btnBack = document.getElementById('btn-back');
            
            if (id === 'macro') {
                controls.classList.remove('visible');
            } else {
                controls.classList.add('visible');
                // Cambiar el color del fondo sutilmente seg√∫n la secci√≥n
                document.getElementById('bg-neural').style.background = 
                    `radial-gradient(circle at 50% 50%, ${hexToRgba(DB[id].color, 0.1)} 0%, #020617 100%)`;
            }
        }

        // Helper para color de fondo
        function hexToRgba(hex, alpha) {
            let r = parseInt(hex.slice(1, 3), 16),
                g = parseInt(hex.slice(3, 5), 16),
                b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // ==========================================
        // PANEL DE INFORMACI√ìN
        // ==========================================
        function showInfo(id, title, color) {
            const panel = document.getElementById('side-panel');
            const content = document.getElementById('panel-content');
            
            // Buscar texto o usar default
            const info = TEXTS[id] || { 
                title: title, 
                text: "Informaci√≥n detallada en proceso de estructuraci√≥n seg√∫n plan maestro MGA.",
                tag: "INFO" 
            };

            // Determinar TAG si no existe
            let tag = info.tag;
            if(!tag) {
                if(id.includes('_legal')) tag = "LEGAL";
                else if(id.startsWith('p_')) tag = "PRODUCTO";
                else if(id.startsWith('c_')) tag = "PROCESO";
                else tag = "GENERAL";
            }

            panel.classList.add('open');

            content.innerHTML = `
                <div class="mb-6 border-l-4 pl-4" style="border-color:${color}">
                    <span class="text-xs font-bold uppercase tracking-widest px-2 py-1 rounded bg-slate-800 border border-slate-700" style="color:${color}; border-color:${color}">
                        ${tag}
                    </span>
                    <h2 class="text-3xl font-rajdhani font-bold text-white mt-3 leading-tight">
                        ${info.title}
                    </h2>
                </div>
                
                <div class="text-slate-300 font-light text-lg leading-relaxed space-y-4">
                    <p>${info.text}</p>
                </div>

                ${id.includes('_legal') ? `
                <div class="mt-8 p-4 bg-green-900/20 rounded-lg border border-green-700/50 flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center bg-green-800">
                        <i class="fa-solid fa-check text-white"></i>
                    </div>
                    <div>
                        <div class="text-xs text-green-400 uppercase font-bold">Cumplimiento</div>
                        <div class="text-sm text-white font-bold">Normativa Verificada</div>
                    </div>
                </div>` : ''}
            `;
        }

        function closePanel() {
            document.getElementById('side-panel').classList.remove('open');
        }

        // Iniciar
        document.addEventListener('DOMContentLoaded', () => {
            renderNode('macro');
        });

    </script>
</body>
</html>

