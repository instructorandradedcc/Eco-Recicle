<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECORECYCLE: Ecosistema Integral</title>
    <link rel="icon" href="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F9FAFB; color: #1F2937; }
        
        /* Gr√°ficos */
        .chart-container { position: relative; width: 100%; max-width: 600px; margin: 0 auto; height: 300px; }
        
        /* --- SISTEMA ORBITAL DIN√ÅMICO --- */
        .eco-hub-container {
            position: relative; width: 100%; height: 700px; max-width: 850px; margin: 0 auto;
            overflow: hidden; border-radius: 20px; transition: opacity 0.5s ease;
        }

        /* L√≠neas */
        .line-from-center {
            position: absolute; top: 50%; left: 50%; height: 2px;
            background-color: #cbd5e1; transform-origin: 0% 50%; z-index: 5; width: 35%;
        }

        /* Nodos */
        .eco-node {
            position: absolute; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; font-weight: bold; cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10;
            background-color: white;
            transform: translate(-50%, -50%); /* Centrado perfecto */
        }
        .eco-node:hover { z-index: 20; transform: translate(-50%, -50%) scale(1.15); box-shadow: 0 10px 15px rgba(0,0,0,0.15); }
        .eco-node.active { transform: translate(-50%, -50%) scale(1.2); z-index: 30; box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.3); }

        /* Nodo Central */
        .node-center {
            width: 170px; height: 170px; 
            color: white; font-size: 1.1rem; z-index: 50;
            border-style: solid; border-width: 6px;
        }

        /* Nodo Sat√©lite */
        .node-satellite {
            width: 100px; height: 100px; 
            font-size: 0.75rem; padding: 5px; line-height: 1.1;
            border-style: solid; border-width: 2px;
        }

        /* Utilidades */
        .hidden-section { display: none; }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Iconos en nodos */
        .node-icon { font-size: 1.5rem; margin-bottom: 2px; }

        @media (max-width: 640px) {
            .eco-hub-container { height: 550px; }
            .node-center { width: 120px; height: 120px; font-size: 0.85rem; }
            .node-satellite { width: 80px; height: 80px; font-size: 0.6rem; }
            .line-from-center { width: 42%; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4 cursor-pointer" onclick="renderSystem('macro')">
                <div class="h-14 w-14 rounded-full overflow-hidden border border-gray-200 shadow-sm bg-white flex items-center justify-center">
                    <img src="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" alt="Logo" class="h-full w-full object-cover">
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900 leading-tight">ECORECYCLE</h1>
                    <p class="text-xs text-gray-500">Fundaci√≥n Ecopiensa Evolution</p>
                </div>
            </div>
            <nav class="hidden md:flex space-x-8">
                <button onclick="renderSystem('macro')" class="text-gray-600 hover:text-green-700 font-medium">Macro-Ecosistema</button>
                <button onclick="scrollToSection('timeline')" class="text-gray-600 hover:text-green-700 font-medium">Cronograma</button>
            </nav>
        </div>
    </header>

    <main class="flex-grow">
        
        <!-- HERO -->
        <section class="bg-gradient-to-b from-green-50 to-white py-12 text-center">
            <div class="max-w-4xl mx-auto px-4">
                <span class="inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold mb-4">Proyecto Triple Impacto</span>
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">Modelo Integral de Gesti√≥n</h2>
                <p class="mt-4 text-xl text-gray-600">Econom√≠a Circular Tecnificada e Inteligencia Artificial.</p>
            </div>
        </section>

        <!-- SECCI√ìN DIN√ÅMICA DE ECOSISTEMA -->
        <section id="ecosystem-section" class="py-10 bg-white border-t border-gray-100 min-h-[800px]">
            <div class="max-w-7xl mx-auto px-4">

                <!-- CABECERA DIN√ÅMICA -->
                <div id="system-header" class="text-center mb-6 transition-all duration-300">
                    <!-- Se llena con JS -->
                </div>

                <!-- CONTENEDOR DEL DIAGRAMA (Se dibuja con JS) -->
                <div id="hub-container" class="eco-hub-container relative">
                    <!-- Los nodos se inyectan aqu√≠ -->
                </div>

                <!-- √ÅREA DE DETALLES -->
                <div id="detail-view" class="bg-gray-50 rounded-2xl shadow-inner border border-gray-200 p-6 md:p-10 min-h-[600px] mt-12 relative scroll-mt-24">
                    <div id="default-content" class="text-center h-full flex flex-col justify-center items-center py-10">
                        <div class="text-5xl mb-4 opacity-50">üëÜ</div>
                        <h4 class="text-2xl font-semibold text-gray-800">Panel de Informaci√≥n Detallada</h4>
                        <p class="text-gray-500 mt-2">Selecciona un nodo del diagrama para ver productos, procesos y normativa legal.</p>
                    </div>
                    <div id="dynamic-content" class="hidden animate-fade-in">
                        <!-- El detalle se inyecta aqu√≠ -->
                    </div>
                </div>

            </div>
        </section>

        <!-- CRONOGRAMA -->
        <section id="timeline" class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-10">
                    <h3 class="text-2xl font-bold text-gray-900">Cronograma General</h3>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-900 text-white py-10">
        <div class="max-w-7xl mx-auto px-4 text-center md:text-left grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="flex flex-col items-center md:items-start">
                <div class="h-12 w-12 rounded-full overflow-hidden bg-white flex items-center justify-center mb-3">
                    <img src="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" alt="Logo Footer" class="h-full w-full object-cover">
                </div>
                <h5 class="text-lg font-bold mb-2 text-green-400">Fundaci√≥n Ecopiensa Evolution</h5>
                <p class="text-xs text-gray-400">Tulu√°, Valle del Cauca</p>
            </div>
            <div>
                <h5 class="text-sm font-bold uppercase tracking-wider mb-3 text-gray-300">Contacto</h5>
                <ul class="text-xs text-gray-400 space-y-1">
                    <li>Arq. Iv√°n Dar√≠o Mej√≠a Mu√±oz</li>
                    <li>Ing. Olmer Geovanny Andrade</li>
                </ul>
            </div>
            <div>
                <h5 class="text-sm font-bold uppercase tracking-wider mb-3 text-gray-300">Marco Legal</h5>
                <p class="text-xs text-gray-400">Cumplimiento Res. 1257 de 2021.</p>
                <p class="text-xs text-gray-400">NIT: 900998128</p>
            </div>
        </div>
    </footer>

    <script>
        // =================================================================
        // BASE DE DATOS DE SISTEMAS (MACRO Y SUB-SISTEMAS)
        // =================================================================
        
        const systemsDB = {
            // ---------------- NIVEL 1: MACRO ECOSISTEMA ----------------
            'macro': {
                theme: 'green',
                center: { title: "ECA CENTRAL", subtitle: "Cerebro Log√≠stico", id: "eca_center", color: "#15803d" },
                intro: { title: "Macro-Ecosistema de Aprovechamiento", desc: "La ECA articula el flujo de recursos hacia l√≠neas especializadas. Haz clic en cada nodo sat√©lite para explorar su ciclo completo." },
                nodes: [
                    { id: "rcd_sys", title: "Aprov. RCD", subtitle: "Escombros", icon: "üèóÔ∏è", color: "#1e40af", targetSystem: "rcd" },
                    { id: "ecocidas_sys", title: "ECO-CIDAS", subtitle: "Tecnolog√≠a", icon: "ü§ñ", color: "#7e22ce", targetSystem: "ecocidas" },
                    { id: "ecocia_sys", title: "ECO-CIA", subtitle: "Agroecolog√≠a", icon: "üåæ", color: "#4338ca", targetSystem: "ecocia" },
                    { id: "lodos_sys", title: "Lodos", subtitle: "Bios√≥lidos", icon: "üíß", color: "#4b5563", targetSystem: "lodos" },
                    { id: "granjas_sys", title: "Eco-Granjas", subtitle: "Productivas", icon: "üêñ", color: "#16a34a", targetSystem: "granjas" },
                    { id: "organicos_sys", title: "Org√°nicos", subtitle: "Compost", icon: "üçÇ", color: "#ca8a04", targetSystem: "organicos" },
                    { id: "reciclables_sys", title: "Reciclables", subtitle: "Pl√°stico/PET", icon: "‚ôªÔ∏è", color: "#0d9488", targetSystem: "reciclables" }
                ]
            },

            // ---------------- NIVEL 2: SUB-SISTEMAS DETALLADOS ----------------
            
            // 1. RCD (Escombros)
            'rcd': {
                theme: 'blue',
                center: { title: "Planta RCD", subtitle: "Transformaci√≥n", id: "rcd_plant", color: "#1e40af" },
                intro: { title: "Ciclo de Gesti√≥n RCD", desc: "Transformaci√≥n de escombros en infraestructura bajo Res. 1257." },
                nodes: [
                    { id: "rcd_rec", title: "Recolecci√≥n", subtitle: "Formalizada", icon: "üê¥", color: "#ea580c" }, // Naranja
                    { id: "rcd_leg", title: "Normativa", subtitle: "Res. 1257", icon: "‚öñÔ∏è", color: "#dc2626" }, // Rojo
                    { id: "rcd_via", title: "V√≠as", subtitle: "Terciarias", icon: "üõ£Ô∏è", color: "#4b5563" },
                    { id: "rcd_pre", title: "Prefabricados", subtitle: "Bloques", icon: "üß±", color: "#1e40af" },
                    { id: "rcd_mob", title: "Mobiliario", subtitle: "Urbano", icon: "ü™ë", color: "#0d9488" },
                    { id: "rcd_imp", title: "Impacto", subtitle: "Ambiental", icon: "üå≥", color: "#15803d" }
                ]
            },

            // 2. ECO-CIDAS (Tecnolog√≠a)
            'ecocidas': {
                theme: 'purple',
                center: { title: "ECO-CIDAS", subtitle: "Cerebro Digital", id: "ecocidas_core", color: "#7e22ce" },
                intro: { title: "Centro de Inteligencia y Desarrollo", desc: "Aplicaci√≥n de IA, Rob√≥tica e IoT para la optimizaci√≥n de procesos." },
                nodes: [
                    { id: "cida_pre", title: "Gesti√≥n", subtitle: "Predictiva", icon: "üìä", color: "#7e22ce" },
                    { id: "cida_rob", title: "Rob√≥tica", subtitle: "Industrial", icon: "ü¶æ", color: "#4338ca" },
                    { id: "cida_bio", title: "Bio", subtitle: "Inteligencia", icon: "üß¨", color: "#16a34a" },
                    { id: "cida_pro", title: "Pr√≥tesis", subtitle: "Bi√≥nicas", icon: "ü¶ø", color: "#0d9488" },
                    { id: "cida_edu", title: "Educaci√≥n", subtitle: "4.0", icon: "üéì", color: "#ca8a04" },
                    { id: "cida_leg", title: "Normativa", subtitle: "MinTIC", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            },

            // 3. ECO-CIA (Agro)
            'ecocia': {
                theme: 'indigo',
                center: { title: "ECO-CIA", subtitle: "Nodo Rural", id: "ecocia_core", color: "#4338ca" },
                intro: { title: "Centro de Integraci√≥n Agroecol√≥gico", desc: "Infraestructura comunitaria para acopio, educaci√≥n y salud." },
                nodes: [
                    { id: "cia_aco", title: "Acopio", subtitle: "Log√≠stico", icon: "üì¶", color: "#4338ca" },
                    { id: "cia_esc", title: "Escuela", subtitle: "Rural", icon: "üè´", color: "#16a34a" },
                    { id: "cia_sal", title: "Puesto", subtitle: "Salud", icon: "üè•", color: "#dc2626" },
                    { id: "cia_mer", title: "Mercado", subtitle: "Justo", icon: "üí∞", color: "#ca8a04" },
                    { id: "cia_tra", title: "Transforma", subtitle: "Alimentos", icon: "üè≠", color: "#ea580c" },
                    { id: "cia_leg", title: "Ley", subtitle: "Campesina", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            },

            // 4. Reciclables
            'reciclables': {
                theme: 'teal',
                center: { title: "Planta Aprovech.", subtitle: "Multimaterial", id: "rec_core", color: "#0d9488" },
                intro: { title: "Valorizaci√≥n de Materiales Secos", desc: "Procesos industriales para pl√°sticos, cart√≥n y vidrio." },
                nodes: [
                    { id: "rec_mad", title: "Madera", subtitle: "Pl√°stica", icon: "ü™µ", color: "#15803d" },
                    { id: "rec_pir", title: "Pir√≥lisis", subtitle: "Combustibles", icon: "üî•", color: "#ea580c" },
                    { id: "rec_fil", title: "Filamento", subtitle: "3D", icon: "üßµ", color: "#7e22ce" },
                    { id: "rec_tex", title: "Fibras", subtitle: "Textiles", icon: "üëï", color: "#4338ca" },
                    { id: "rec_tie", title: "Eco-Tiendas", subtitle: "Trueque", icon: "üè™", color: "#ca8a04" },
                    { id: "rec_leg", title: "Res. 1407", subtitle: "Envases", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            },

            // 5. Org√°nicos
            'organicos': {
                theme: 'yellow',
                center: { title: "Planta Org√°nicos", subtitle: "Biotecnolog√≠a", id: "org_core", color: "#ca8a04" },
                intro: { title: "Transformaci√≥n de Biomasa", desc: "Tecnolog√≠a para devolver nutrientes al suelo." },
                nodes: [
                    { id: "org_com", title: "Compostaje", subtitle: "Tecnificado", icon: "üçÇ", color: "#a16207" },
                    { id: "org_lom", title: "Lombricultura", subtitle: "Humus", icon: "ü™±", color: "#854d0e" },
                    { id: "org_sit", title: "Reactor", subtitle: "SITAV", icon: "‚öóÔ∏è", color: "#7e22ce" },
                    { id: "org_abo", title: "Abonos", subtitle: "L√≠quidos", icon: "üíß", color: "#15803d" },
                    { id: "org_sue", title: "Recuperaci√≥n", subtitle: "Suelos", icon: "üå±", color: "#16a34a" },
                    { id: "org_leg", title: "Res. 054", subtitle: "Aseo", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            },

            // 6. Ecogranjas
            'granjas': {
                theme: 'green',
                center: { title: "Eco-Granja", subtitle: "Unidad Productiva", id: "gra_core", color: "#16a34a" },
                intro: { title: "Seguridad Alimentaria Autosostenible", desc: "Producci√≥n limpia utilizando insumos del ecosistema." },
                nodes: [
                    { id: "gra_cul", title: "Cultivos", subtitle: "Pancoger", icon: "üåΩ", color: "#16a34a" },
                    { id: "gra_pec", title: "Pecuaria", subtitle: "Estabulada", icon: "üêÑ", color: "#854d0e" },
                    { id: "gra_pis", title: "Piscicultura", subtitle: "Tanques", icon: "üêü", color: "#0ea5e9" },
                    { id: "gra_ene", title: "Biog√°s", subtitle: "Energ√≠a", icon: "‚ö°", color: "#ca8a04" },
                    { id: "gra_seg", title: "Seguridad", subtitle: "Alimentaria", icon: "üç≤", color: "#ea580c" },
                    { id: "gra_leg", title: "ODS 2", subtitle: "Hambre 0", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            },

            // 7. Lodos
            'lodos': {
                theme: 'gray',
                center: { title: "Planta Lodos", subtitle: "Tratamiento", id: "lod_core", color: "#4b5563" },
                intro: { title: "Gesti√≥n de Bios√≥lidos", desc: "Saneamiento y valorizaci√≥n de lodos de PTAR." },
                nodes: [
                    { id: "lod_sec", title: "Secado", subtitle: "T√©rmico", icon: "‚òÄÔ∏è", color: "#ea580c" },
                    { id: "lod_bio", title: "Bios√≥lidos", subtitle: "Estabilizados", icon: "üí©", color: "#57534e" },
                    { id: "lod_com", title: "Combustible", subtitle: "Alterno", icon: "üî•", color: "#7f1d1d" },
                    { id: "lod_sue", title: "Mejorador", subtitle: "Suelo", icon: "üå±", color: "#15803d" },
                    { id: "lod_pta", title: "PTAR", subtitle: "Origen", icon: "üè≠", color: "#1e3a8a" },
                    { id: "lod_leg", title: "Dec. 1287", subtitle: "Norma", icon: "‚öñÔ∏è", color: "#dc2626" }
                ]
            }
        };

        // =================================================================
        // BASE DE DATOS DE DETALLES (TEXTOS)
        // =================================================================
        const detailsDB = {
            // CENTRALES
            'eca_center': { title: "ECA Central", intro: "N√∫cleo Log√≠stico.", details: ["Recepci√≥n.", "Clasificaci√≥n.", "Despacho."], legal: "Vigilado Superservicios.", chart: {label:['Entrada'], data:[100]} },
            'rcd_plant': { title: "Planta RCD", intro: "Trituraci√≥n Industrial.", details: ["Agregados.", "Finos.", "Metales."], legal: "Licencia Ambiental CVC.", chart: {label:['Agregados', 'Finos'], data:[70, 30]} },
            'ecocidas_core': { title: "Cerebro Digital", intro: "Data Center.", details: ["Servidores.", "IoT Hub.", "Monitoreo."], legal: "Ley de Datos.", chart: {label:['Procesamiento'], data:[100]} },
            'ecocia_core': { title: "Centro Rural", intro: "Infraestructura Comunitaria.", details: ["Bodegas.", "Aulas.", "Consultorios."], legal: "POT Municipal.", chart: {label:['Capacidad'], data:[100]} },
            'rec_core': { title: "Planta Pol√≠meros", intro: "Transformaci√≥n Pl√°stica.", details: ["Lavado.", "Aglutinado.", "Extrusi√≥n."], legal: "Normas Vertimiento.", chart: {label:['PET', 'PEAD'], data:[60, 40]} },
            'org_core': { title: "Planta Bio", intro: "Fermentaci√≥n Controlada.", details: ["Reactores.", "Volteo.", "Empaque."], legal: "ICA (Abonos).", chart: {label:['Compost', 'Lixiviados'], data:[80, 20]} },
            'gra_core': { title: "Granja Integral", intro: "Modelo Productivo.", details: ["Parcelas.", "Galpones.", "Estanques."], legal: "Uso de Suelo.", chart: {label:['Veg', 'Animal'], data:[50, 50]} },
            'lod_core': { title: "Tratamiento Lodos", intro: "Saneamiento.", details: ["Deshidrataci√≥n.", "Higienizaci√≥n."], legal: "Dec. 1287.", chart: {label:['Humedad Reducida'], data:[90]} },

            // RCD
            'rcd_rec': { title: "Recolecci√≥n Formal", intro: "Sustituci√≥n tracci√≥n animal.", details: ["Motocarros.", "Rutas GPS."], legal: "Ley 2138/2021." },
            'rcd_leg': { title: "Normativa RCD", intro: "Res. 1257 de 2021.", details: ["Meta 30% aprovecha.", "Gestores inscritos."], legal: "Obligatorio cumplimiento." },
            'rcd_via': { title: "V√≠as Terciarias", intro: "Sub-base granular.", details: ["Material B-200.", "Afirmado rural."], legal: "Normas INVIAS." },
            'rcd_pre': { title: "Prefabricados", intro: "Ladrillos Ecol√≥gicos.", details: ["Tipo Lego.", "Adoquines."], legal: "NTC (Normas T√©cnicas)." },
            'rcd_mob': { title: "Mobiliario Urbano", intro: "Espacio P√∫blico.", details: ["Bancas.", "Bolardos."], legal: "Manual Espacio P√∫blico." },
            'rcd_imp': { title: "Impacto Ambiental", intro: "Mitigaci√≥n.", details: ["Cero escombreras.", "Menos CO2."], legal: "Ley 1333 (Sancionatorio)." },

            // ECO-CIDAS
            'cida_pre': { title: "Gesti√≥n Predictiva", intro: "ERP con IA.", details: ["Predicci√≥n residuos.", "Rutas din√°micas."], legal: "Pol√≠tica Gobierno Digital." },
            'cida_rob': { title: "Rob√≥tica Pesada", intro: "Maquinaria Aut√≥noma.", details: ["Excavadoras.", "Bandas inteligentes."], legal: "Seguridad Industrial." },
            'cida_bio': { title: "Bio-Inteligencia", intro: "Sensores IoT.", details: ["Control pH/Temp.", "Alertas tempranas."], legal: "Normas T√©cnicas Sectoriales." },
            'cida_pro': { title: "Pr√≥tesis Bi√≥nicas", intro: "Dise√±o Generativo.", details: ["Escaneo 3D.", "Impresi√≥n en PET."], legal: "Registro INVIMA." },
            'cida_edu': { title: "Educaci√≥n 4.0", intro: "Aulas Virtuales.", details: ["Capacitaci√≥n VR.", "Cursos online."], legal: "Ley General Educaci√≥n." },
            'cida_leg': { title: "Normativa TIC", intro: "MinTIC.", details: ["Ley 1951 (MinCiencias).", "Transformaci√≥n Digital."], legal: "Conpes 3975 (IA)." },

            // ECO-CIA
            'cia_aco': { title: "Acopio Log√≠stico", intro: "Centro de Carga.", details: ["Pesaje.", "Clasificaci√≥n."], legal: "Normas Transporte." },
            'cia_esc': { title: "Escuela Rural", intro: "Formaci√≥n.", details: ["T√©cnicas agr√≠colas.", "Sostenibilidad."], legal: "PEI Rural." },
            'cia_sal': { title: "Salud Rural", intro: "Bienestar.", details: ["Telemedicina.", "Prevenci√≥n."], legal: "Ley 100." },
            'cia_mer': { title: "Mercado Justo", intro: "Sin intermediarios.", details: ["Venta directa.", "Precios justos."], legal: "Pol√≠tica Agraria." },
            'cia_tra': { title: "Transformaci√≥n", intro: "Valor Agregado.", details: ["Pulpas.", "Mermeladas."], legal: "Buenas Pr√°cticas (BPM)." },
            'cia_leg': { title: "Ley Campesina", intro: "Res. 464 de 2017.", details: ["Agricultura Familiar.", "Derechos Campesinos."], legal: "Constituci√≥n Pol√≠tica." },

            // RECICLABLES
            'rec_mad': { title: "Madera Pl√°stica", intro: "Econ√≥mica y Durable.", details: ["Postes.", "Estibas."], legal: "NTC Maderas Pl√°sticas." },
            'rec_pir': { title: "Pir√≥lisis", intro: "Waste to Energy.", details: ["Combustibles.", "Negro de humo."], legal: "Emisiones Atmosf√©ricas." },
            'rec_fil': { title: "Filamento 3D", intro: "Insumo Tecnol√≥gico.", details: ["PET reciclado.", "Bobinas."], legal: "Calidad de Materiales." },
            'rec_tex': { title: "Fibras Textiles", intro: "Moda Circular.", details: ["Relleno t√©rmico.", "Hilos."], legal: "Etiquetado Textil." },
            'rec_tie': { title: "Eco-Tiendas", intro: "Trueque Ambiental.", details: ["Puntos por comida.", "Recolecci√≥n barrial."], legal: "Econom√≠a Solidaria." },
            'rec_leg': { title: "Res. 1407/2018", intro: "Resp. Extendida.", details: ["Envases y Empaques.", "Metas recolecci√≥n."], legal: "MinAmbiente." },

            // ORGANICOS
            'org_com': { title: "Compostaje", intro: "Aer√≥bico.", details: ["Pilas volteadas.", "Aireaci√≥n."], legal: "Norma T√©cnica NTC 5167." },
            'org_lom': { title: "Lombricultura", intro: "Humus Rojo.", details: ["Lombriz Roja.", "Sustrato."], legal: "Abonos Org√°nicos." },
            'org_sit': { title: "Reactor SITAV", intro: "Alta Tecnolog√≠a.", details: ["Aceleraci√≥n.", "Control olores."], legal: "Permisos Ambientales." },
            'org_abo': { title: "Abonos L√≠quidos", intro: "Bio-fertilizantes.", details: ["Lixiviados tratados.", "Ricos en NPK."], legal: "Registro ICA." },
            'org_sue': { title: "Recuperaci√≥n", intro: "Suelos Degradados.", details: ["Materia org√°nica.", "Retenci√≥n agua."], legal: "Pol√≠tica Suelos." },
            'org_leg': { title: "Res. 054/2021", intro: "Tarifa Aseo.", details: ["Incentivo aprovechamiento.", "Separaci√≥n fuente."], legal: "CRA (Comisi√≥n Regulaci√≥n)." },

            // GRANJAS
            'gra_cul': { title: "Cultivos", intro: "Pancoger.", details: ["Hortalizas.", "Frutales."], legal: "Buenas Pr√°cticas Agr√≠colas." },
            'gra_pec': { title: "Pecuaria", intro: "Estabulada.", details: ["Cerdos.", "Aves."], legal: "Bienestar Animal." },
            'gra_pis': { title: "Piscicultura", intro: "Tanques.", details: ["Tilapia.", "Cachama."], legal: "AUNAP." },
            'gra_ene': { title: "Biog√°s", intro: "Energ√≠a Renovable.", details: ["Biodigestores.", "Cocina/Calor."], legal: "Ley 1715 (Renovables)." },
            'gra_seg': { title: "Seguridad Alim.", intro: "Autoabastecimiento.", details: ["Comida local.", "Nutrici√≥n."], legal: "Pol√≠tica SAN." },
            'gra_leg': { title: "ODS 2", intro: "Hambre Cero.", details: ["Sostenibilidad.", "Agricultura." ], legal: "Agenda 2030." },

            // LODOS
            'lod_sec': { title: "Secado T√©rmico", intro: "Reducci√≥n volumen.", details: ["Hornos solares.", "Baja humedad."], legal: "Emisiones." },
            'lod_bio': { title: "Bios√≥lidos", intro: "Estabilizados.", details: ["Clase A/B.", "Sin pat√≥genos."], legal: "Dec. 1287/2014." },
            'lod_com': { title: "Combustible", intro: "Valor energ√©tico.", details: ["Cogeneraci√≥n.", "Hornos cementeros."], legal: "Coprecesamiento." },
            'lod_sue': { title: "Mejorador", intro: "Aplicaci√≥n Agr√≠cola.", details: ["Nitr√≥geno.", "F√≥sforo."], legal: "Manual Bios√≥lidos." },
            'lod_pta': { title: "Origen PTAR", intro: "Aguas Residuales.", details: ["Lodos primarios.", "Lodos activados."], legal: "Plan Saneamiento." },
            'lod_leg': { title: "Normativa", intro: "Decreto 1287.", details: ["L√≠mites metales.", "Restricciones uso."], legal: "MinVivienda." }
        };

        // =================================================================
        // L√ìGICA DE RENDERIZADO
        // =================================================================

        let currentSystem = 'macro';
        let currentChart = null;

        function renderSystem(systemKey) {
            currentSystem = systemKey;
            const sys = systemsDB[systemKey];
            const container = document.getElementById('hub-container');
            const header = document.getElementById('system-header');
            
            // 1. Limpiar contenedor
            container.innerHTML = '';
            document.getElementById('detail-view').scrollIntoView({ behavior: 'smooth' });
            
            // 2. Bot√≥n Volver (si no es macro)
            let backBtn = '';
            if(systemKey !== 'macro') {
                backBtn = `<button onclick="renderSystem('macro')" class="mb-2 inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">‚Üê Volver al Macro-Ecosistema</button>`;
            }

            // 3. Actualizar Header
            header.innerHTML = `
                ${backBtn}
                <div>
                    <span class="text-${sys.theme}-600 font-bold uppercase text-sm tracking-wider">
                        ${systemKey === 'macro' ? 'Nivel 1: Visi√≥n General' : 'Nivel 2: Exploraci√≥n Profunda'}
                    </span>
                    <h3 class="text-3xl font-bold text-gray-900 mt-1">${sys.intro.title}</h3>
                    <p class="mt-2 text-gray-500 max-w-2xl mx-auto">${sys.intro.desc}</p>
                </div>
            `;

            // 4. Dibujar Nodo Central
            const centerNode = document.createElement('div');
            centerNode.className = `eco-node node-center shadow-lg border-${sys.theme}-200 bg-${sys.theme}-600`;
            centerNode.style.background = `linear-gradient(135deg, ${sys.center.color}, #333)`; // Degradado sutil
            centerNode.style.borderColor = `${sys.center.color}40`; // Transparencia en borde
            centerNode.style.left = '50%';
            centerNode.style.top = '50%';
            centerNode.innerHTML = `${sys.center.title}<br><span class="text-xs font-normal opacity-90 mt-1 block">${sys.center.subtitle}</span>`;
            centerNode.onclick = () => showDetail(sys.center.id, sys.center.color);
            container.appendChild(centerNode);

            // 5. Dibujar Sat√©lites
            const count = sys.nodes.length;
            const angleStep = 360 / count;
            const startAngle = -90; // Empezar arriba (12 en punto)

            sys.nodes.forEach((node, index) => {
                const angle = startAngle + (index * angleStep);
                
                // L√≠nea
                const line = document.createElement('div');
                line.className = 'line-from-center';
                line.style.transform = `rotate(${angle}deg)`;
                line.style.backgroundColor = node.color || '#cbd5e1';
                container.appendChild(line);

                // Nodo (C√°lculo de posici√≥n usando CSS trigonom√©trico o porcentajes aproximados)
                // Para simplificar y evitar JS Math complejo en inline styles, usamos rotate en un contenedor padre
                // o calculamos top/left. Vamos a calcular top/left bas√°ndonos en radio.
                
                const radius = 35; // % del contenedor (mitad de 700px aprox es radio, usamos %)
                const rad = (angle * Math.PI) / 180;
                const x = 50 + (radius * Math.cos(rad)); // % Left
                const y = 50 + (radius * Math.sin(rad)); // % Top

                const satNode = document.createElement('div');
                satNode.className = `eco-node node-satellite shadow hover:shadow-lg`;
                satNode.style.left = `${x}%`;
                satNode.style.top = `${y}%`;
                satNode.style.borderColor = node.color;
                satNode.style.color = node.color;
                
                satNode.innerHTML = `
                    <div class="node-icon">${node.icon}</div>
                    ${node.title}<br>
                    <span class="text-[9px] text-gray-400 block mt-1">${node.subtitle}</span>
                `;

                // Acci√≥n al hacer click
                satNode.onclick = () => {
                    // Si es Macro y tiene target, ir al subsistema
                    if (systemKey === 'macro' && node.targetSystem) {
                        showDetail(node.id, node.color, node.targetSystem); // Mostrar detalle primero, opcion de entrar
                    } else {
                        showDetail(node.id, node.color);
                    }
                };

                container.appendChild(satNode);
            });
        }

        // =================================================================
        // MOSTRAR DETALLES
        // =================================================================
        function showDetail(id, color, targetSystem = null) {
            const data = detailsDB[id];
            // Si no hay dato exacto, buscar en la DB de sistemas (para nodos de macro)
            const fallback = systemsDB['macro'].nodes.find(n => n.id === id);
            
            const title = data ? data.title : (fallback ? fallback.title : "Detalle");
            const intro = data ? data.intro : "Informaci√≥n detallada del componente.";
            const details = data ? data.details : ["Informaci√≥n t√©cnica en desarrollo."];
            const legal = data ? data.legal : "Cumplimiento normativo general.";

            // Bot√≥n de Zoom In si aplica
            let zoomBtn = '';
            if (targetSystem) {
                zoomBtn = `
                    <button onclick="renderSystem('${targetSystem}')" class="mt-4 w-full px-6 py-3 bg-${color === '#1e40af' ? 'blue' : 'green'}-600 text-white font-bold rounded-lg shadow-lg hover:opacity-90 transition transform hover:-translate-y-1 animate-pulse" style="background-color: ${color}">
                        üîç EXPLORAR A FONDO ESTA RAMA
                    </button>
                `;
            }

            // UI Update
            document.getElementById('default-content').classList.add('hidden');
            const dynamic = document.getElementById('dynamic-content');
            dynamic.classList.remove('hidden');

            dynamic.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate-fade-in">
                    <div class="flex flex-col justify-center">
                        <div class="flex items-center mb-3">
                            <span class="w-2 h-8 rounded-full mr-3" style="background-color: ${color}"></span>
                            <h3 class="text-2xl font-bold text-gray-800">${title}</h3>
                        </div>
                        <p class="text-lg text-gray-600 mb-4 italic border-l-4 pl-4 py-2 bg-gray-50 rounded-r" style="border-color: ${color}40">
                            "${intro}"
                        </p>
                        
                        <div class="mb-4">
                            <h5 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Caracter√≠sticas Clave</h5>
                            <ul class="space-y-2">
                                ${details.map(d => `<li class="flex items-start text-sm text-gray-700"><span class="mr-2" style="color:${color}">‚û§</span><span>${d}</span></li>`).join('')}
                            </ul>
                        </div>

                        <div class="p-4 rounded-lg border bg-white" style="border-color: ${color}40">
                            <h5 class="text-xs font-bold uppercase tracking-wider mb-2 flex items-center" style="color: ${color}">
                                <span class="text-lg mr-2">‚öñÔ∏è</span> Marco Legal & Normativo
                            </h5>
                            <p class="text-sm text-gray-700 text-justify leading-relaxed">
                                ${legal}
                            </p>
                        </div>

                        ${zoomBtn}
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center">
                        <h5 class="text-xs font-bold text-gray-400 mb-4 uppercase tracking-wider w-full text-center border-b pb-2">Datos de Impacto</h5>
                        <div class="chart-container w-full h-64"><canvas id="detailChart"></canvas></div>
                    </div>
                </div>
            `;

            // Gr√°fico Dummy o Real si existe
            const chartData = data && data.chart ? data.chart : { label: ['Dato A', 'Dato B'], data: [50, 50] };
            renderDetailChart(chartData, color);
        }

        function renderDetailChart(data, color) {
            const ctx = document.getElementById('detailChart').getContext('2d');
            if (currentChart) currentChart.destroy();

            currentChart = new Chart(ctx, {
                type: 'doughnut', // Por defecto
                data: {
                    labels: data.label,
                    datasets: [{
                        data: data.data,
                        backgroundColor: [color, color + '80', color + '40'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function initTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Fase 1: Infraestructura', 'Fase 2: Expansi√≥n', 'Fase 3: Consolidaci√≥n'],
                    datasets: [{ label: 'Meses', data: [12, 12, 36], backgroundColor: ['#bbf7d0', '#4ade80', '#16a34a'] }]
                },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false } } }
            });
        }

        // INICIO
        document.addEventListener('DOMContentLoaded', () => {
            renderSystem('macro'); // Cargar vista inicial
            initTimelineChart();
        });

    </script>
</body>
</html>

